// ===== PRISMA SCHEMA FOR NAGA STALL DATABASE =====
// This schema was generated based on the existing database structure
// Run: npx prisma db pull to sync with existing database
// Run: npx prisma generate to generate the Prisma Client

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma-client"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// ===== CORE MODELS =====

model Branch {
  branch_id      Int      @id @default(autoincrement())
  branch_name    String   @db.VarChar(255)
  location       String?  @db.VarChar(255)
  address        String?  @db.Text
  contact_number String?  @db.VarChar(50)
  email          String?  @db.VarChar(255)
  description    String?  @db.Text
  status         String   @default("active") @db.VarChar(50)
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt

  // Relations
  stalls       Stall[]
  employees    Employee[]
  floors       Floor[]
  sections     Section[]
  stallholders Stallholder[]

  @@map("branch")
}

model Floor {
  floor_id     Int      @id @default(autoincrement())
  branch_id    Int
  floor_name   String   @db.VarChar(100)
  floor_number Int
  description  String?  @db.Text
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  // Relations
  branch   Branch    @relation(fields: [branch_id], references: [branch_id])
  stalls   Stall[]
  sections Section[]

  @@map("floor")
}

model Section {
  section_id   Int      @id @default(autoincrement())
  branch_id    Int
  floor_id     Int?
  section_name String   @db.VarChar(100)
  description  String?  @db.Text
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  // Relations
  branch Branch  @relation(fields: [branch_id], references: [branch_id])
  floor  Floor?  @relation(fields: [floor_id], references: [floor_id])
  stalls Stall[]

  @@map("section")
}

model Stall {
  stall_id       Int      @id @default(autoincrement())
  stall_number   String?  @db.VarChar(50)
  stall_name     String?  @db.VarChar(255)
  stall_type     String?  @db.VarChar(100)
  stall_size     String?  @db.VarChar(50)
  stall_location String?  @db.VarChar(255)
  size           String?  @db.VarChar(50)
  area_sqm       Decimal? @db.Decimal(10, 2)
  floor_id       Int?
  section_id     Int?
  monthly_rent   Decimal? @db.Decimal(10, 2)
  rental_price   Decimal? @db.Decimal(10, 2)
  status         String   @default("available") @db.VarChar(50)
  branch_id      Int
  stallholder_id Int?
  floor_level    String?  @db.VarChar(50)
  section        String?  @db.VarChar(100)
  description    String?  @db.Text
  price_type     String?  @db.VarChar(50)
  is_available   Boolean  @default(true)
  base_rate      Decimal? @db.Decimal(10, 2)
  rate_per_sqm   Decimal? @db.Decimal(10, 2)
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt

  // Relations
  branch      Branch       @relation(fields: [branch_id], references: [branch_id])
  floor       Floor?       @relation(fields: [floor_id], references: [floor_id])
  sectionRef  Section?     @relation(fields: [section_id], references: [section_id])
  stallholder Stallholder? @relation(fields: [stallholder_id], references: [stallholder_id])
  images      StallImage[]
  payments    Payment[]
  compliances Compliance[]
  complaints  Complaint[]
  vendors     Vendor[]

  @@map("stall")
}

model StallImage {
  image_id   Int      @id @default(autoincrement())
  stall_id   Int
  filename   String?  @db.VarChar(255)
  image_data Bytes?   @db.LongBlob
  mime_type  String?  @db.VarChar(100)
  is_primary Boolean  @default(false)
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  // Relations
  stall Stall @relation(fields: [stall_id], references: [stall_id], onDelete: Cascade)

  @@map("stall_images")
}

model Stallholder {
  stallholder_id Int      @id @default(autoincrement())
  first_name     String   @db.VarChar(255)
  last_name      String   @db.VarChar(255)
  email          String?  @db.VarChar(255)
  phone_number   String?  @db.VarChar(50)
  address        String?  @db.Text
  business_name  String?  @db.VarChar(255)
  business_type  String?  @db.VarChar(100)
  branch_id      Int?
  status         String   @default("active") @db.VarChar(50)
  password       String?  @db.VarChar(255)
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt

  // Relations
  branch       Branch?       @relation(fields: [branch_id], references: [branch_id])
  stalls       Stall[]
  payments     Payment[]
  applications Application[]

  @@map("stallholder")
}

model Employee {
  employee_id  Int      @id @default(autoincrement())
  first_name   String   @db.VarChar(255)
  last_name    String   @db.VarChar(255)
  email        String   @unique @db.VarChar(255)
  phone_number String?  @db.VarChar(50)
  position     String?  @db.VarChar(100)
  role         String   @default("staff") @db.VarChar(50)
  branch_id    Int?
  password     String   @db.VarChar(255)
  status       String   @default("active") @db.VarChar(50)
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  // Relations
  branch       Branch?       @relation(fields: [branch_id], references: [branch_id])
  inspections  Compliance[]  @relation("inspector")
  collections  Payment[]     @relation("collector")
  activityLogs ActivityLog[]

  @@map("employee")
}

model Application {
  application_id  Int      @id @default(autoincrement())
  applicant_name  String?  @db.VarChar(255)
  applicant_email String?  @db.VarChar(255)
  applicant_phone String?  @db.VarChar(50)
  business_name   String?  @db.VarChar(255)
  business_type   String?  @db.VarChar(100)
  stall_id        Int?
  stallholder_id  Int?
  status          String   @default("pending") @db.VarChar(50)
  notes           String?  @db.Text
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt

  // Relations
  stallholder Stallholder? @relation(fields: [stallholder_id], references: [stallholder_id])

  @@map("application")
}

model Payment {
  payment_id     Int       @id @default(autoincrement())
  stall_id       Int?
  stallholder_id Int?
  amount         Decimal   @db.Decimal(10, 2)
  payment_date   DateTime?
  payment_type   String?   @db.VarChar(50)
  payment_method String?   @db.VarChar(50)
  status         String    @default("pending") @db.VarChar(50)
  reference_no   String?   @db.VarChar(100)
  collector_id   Int?
  notes          String?   @db.Text
  created_at     DateTime  @default(now())
  updated_at     DateTime  @updatedAt

  // Relations
  stall       Stall?       @relation(fields: [stall_id], references: [stall_id])
  stallholder Stallholder? @relation(fields: [stallholder_id], references: [stallholder_id])
  collector   Employee?    @relation("collector", fields: [collector_id], references: [employee_id])

  @@map("payment")
}

model Compliance {
  compliance_id   Int       @id @default(autoincrement())
  stall_id        Int
  inspector_id    Int?
  compliance_type String?   @db.VarChar(100)
  status          String    @default("pending") @db.VarChar(50)
  inspection_date DateTime?
  remarks         String?   @db.Text
  evidence        Bytes?    @db.LongBlob
  evidence_type   String?   @db.VarChar(100)
  created_at      DateTime  @default(now())
  updated_at      DateTime  @updatedAt

  // Relations
  stall     Stall     @relation(fields: [stall_id], references: [stall_id])
  inspector Employee? @relation("inspector", fields: [inspector_id], references: [employee_id])

  @@map("compliance")
}

model Complaint {
  complaint_id   Int      @id @default(autoincrement())
  stall_id       Int?
  complainant    String?  @db.VarChar(255)
  complaint_type String?  @db.VarChar(100)
  description    String?  @db.Text
  status         String   @default("pending") @db.VarChar(50)
  resolution     String?  @db.Text
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt

  // Relations
  stall Stall? @relation(fields: [stall_id], references: [stall_id])

  @@map("complaint")
}

model Vendor {
  vendor_id      Int      @id @default(autoincrement())
  stall_id       Int?
  vendor_name    String   @db.VarChar(255)
  contact_number String?  @db.VarChar(50)
  email          String?  @db.VarChar(255)
  product_type   String?  @db.VarChar(100)
  status         String   @default("active") @db.VarChar(50)
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt

  // Relations
  stall Stall? @relation(fields: [stall_id], references: [stall_id])

  @@map("vendor")
}

model ActivityLog {
  log_id      Int      @id @default(autoincrement())
  employee_id Int?
  action      String   @db.VarChar(100)
  description String?  @db.Text
  entity_type String?  @db.VarChar(50)
  entity_id   Int?
  ip_address  String?  @db.VarChar(50)
  created_at  DateTime @default(now())

  // Relations
  employee Employee? @relation(fields: [employee_id], references: [employee_id])

  @@map("activity_log")
}

model Subscription {
  subscription_id   Int      @id @default(autoincrement())
  name              String   @db.VarChar(255)
  email             String   @db.VarChar(255)
  subscription_type String?  @db.VarChar(50)
  status            String   @default("active") @db.VarChar(50)
  created_at        DateTime @default(now())
  updated_at        DateTime @updatedAt

  @@map("subscription")
}
